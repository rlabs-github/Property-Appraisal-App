# Backend Production Dockerfile (docker/backend/Dockerfile.prod)
# Use Node base image
FROM node:20-alpine AS backend

# Create app directory
WORKDIR /app

# Install latest npm
RUN npm install -g npm@latest

# Copy backend code AND shared tsconfig
COPY backend ./backend
COPY tsconfig.json ./tsconfig.json

# Change working dir to backend
WORKDIR /app/backend

# Install dependencies
RUN npm ci

# Build the app (now tsconfig.json is accessible)
RUN npm run build

EXPOSE 4000

CMD ["npm", "start"]
